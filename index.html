<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sorcerer II">
    <title>Voyage of the Sorcerer II</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, #0a1526 0%, #1e3c72 100%);
            color: white;
            overflow-x: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        .game-container {
            min-height: 100vh;
            position: relative;
        }

        .header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,20,40,0.9) 100%);
            border-bottom: 2px solid #4a90e2;
        }

        .title {
            font-size: 3.2em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
            font-weight: 300;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        .title-main {
            font-size: 1.8em;
            font-weight: 100;
            letter-spacing: 8px;
            margin-bottom: 10px;
        }

        .title-of {
            font-size: 1.2em;
            font-style: italic;
            font-weight: 300;
            letter-spacing: 2px;
            margin: 0 10px;
        }

        .title-sorcerer {
            font-size: 2.2em;
            font-weight: 400;
            letter-spacing: 6px;
        }

        .subtitle {
            font-size: 1em;
            opacity: 0.9;
            font-weight: 300;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.3);
            padding-top: 15px;
        }

        .game-area {
            display: flex;
            height: calc(100vh - 150px);
        }

        /* Mobile Layout */
        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
                height: auto;
                min-height: calc(100vh - 120px);
            }
            
            .ocean-view {
                flex: none;
                height: 50vh;
                min-height: 300px;
            }
            
            .controls-panel {
                flex: none;
                height: auto;
                max-height: 50vh;
                overflow-y: auto;
                padding: 15px;
            }
            
            .header {
                padding: 15px 10px;
            }
            
            .title {
                font-size: 2em;
            }
            
            .title-main {
                font-size: 1.4em;
                letter-spacing: 4px;
            }
            
            .title-sorcerer {
                font-size: 1.8em;
                letter-spacing: 3px;
            }
            
            .subtitle {
                font-size: 0.9em;
                letter-spacing: 1px;
            }
        }

        .ocean-view {
            flex: 2;
            background: linear-gradient(180deg, #4682b4 0%, #191970 100%);
            position: relative;
            overflow: hidden;
        }

        .ocean-info {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9em;
            text-align: center;
            min-width: 200px;
        }

        /* Mobile ocean info */
        @media (max-width: 768px) {
            .ocean-info {
                top: 10px;
                padding: 10px;
                font-size: 0.8em;
                min-width: 180px;
            }
        }

        .controls-panel {
            flex: 1;
            background: rgba(0,0,0,0.4);
            padding: 20px;
            overflow-y: auto;
        }

        .ship {
            position: absolute;
            width: 160px;
            height: 100px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.5s ease;
            animation: shipBob 4s ease-in-out infinite;
            z-index: 10;
        }

        .ship-hull {
            width: 100%;
            height: 45px;
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 30%, #e9ecef 70%, #ced4da 100%);
            border-radius: 80px 80px 12px 12px;
            position: relative;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            border: 2px solid #adb5bd;
        }

        .ship-hull::before {
            content: '';
            position: absolute;
            width: 90%;
            height: 12px;
            background: linear-gradient(90deg, #495057, #6c757d, #495057);
            border-radius: 25px;
            top: 8px;
            left: 5%;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.3);
        }

        .ship-hull::after {
            content: 'SORCERER II';
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            font-weight: bold;
            color: #495057;
            letter-spacing: 1px;
        }

        .ship-deck {
            position: absolute;
            width: 85%;
            height: 20px;
            background: linear-gradient(45deg, #f8f9fa, #ffffff);
            border-radius: 40px;
            left: 7.5%;
            top: -15px;
            border: 1px solid #dee2e6;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .ship-cabin {
            position: absolute;
            width: 70px;
            height: 30px;
            background: linear-gradient(180deg, #ffffff, #f1f3f4);
            border-radius: 10px;
            left: 50%;
            top: -25px;
            transform: translateX(-50%);
            border: 2px solid #ced4da;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .ship-cabin::before {
            content: '';
            position: absolute;
            width: 50px;
            height: 8px;
            background: linear-gradient(45deg, #17a2b8, #20c997);
            border-radius: 4px;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }

        .ship-mast-main {
            position: absolute;
            width: 4px;
            height: 90px;
            background: linear-gradient(180deg, #6c757d, #495057);
            left: 55%;
            top: -80px;
            transform: translateX(-50%);
            border-radius: 2px;
            box-shadow: 2px 0 4px rgba(0,0,0,0.3);
        }

        .ship-mast-front {
            position: absolute;
            width: 3px;
            height: 60px;
            background: linear-gradient(180deg, #6c757d, #495057);
            left: 25%;
            top: -55px;
            transform: translateX(-50%);
            border-radius: 2px;
            box-shadow: 1px 0 3px rgba(0,0,0,0.3);
        }

        .ship-sail-main {
            position: absolute;
            width: 40px;
            height: 55px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 4px;
            left: 75px;
            top: -75px;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.3);
            animation: sailFlutter 3s ease-in-out infinite;
            border: 1px solid #e9ecef;
        }

        .ship-sail-front {
            position: absolute;
            width: 25px;
            height: 40px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 3px;
            left: 20px;
            top: -50px;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            animation: sailFlutter 3.5s ease-in-out infinite;
            border: 1px solid #e9ecef;
        }

        .ship-equipment {
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, #6c757d, #495057);
            border-radius: 50%;
            left: 15px;
            top: -20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.4);
        }

        .ship-equipment::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #6c757d, #495057);
            border-radius: 50%;
            left: 115px;
            top: 2px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.4);
        }

        .ship-antenna {
            position: absolute;
            width: 1px;
            height: 25px;
            background: #495057;
            left: 50%;
            top: -50px;
            transform: translateX(-50%);
        }

        .ship-antenna::before {
            content: '';
            position: absolute;
            width: 3px;
            height: 3px;
            background: #dc3545;
            border-radius: 50%;
            left: -1px;
            top: -3px;
        }

        @keyframes shipBob {
            0%, 100% { transform: translate(-50%, -50%) rotate(-1deg); }
            50% { transform: translate(-50%, -50%) rotate(1deg); }
        }

        @keyframes sailFlutter {
            0%, 100% { transform: scaleX(1); }
            50% { transform: scaleX(1.1); }
        }

        .specimen {
            position: absolute;
            width: 30px;
            height: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: float 4s ease-in-out infinite;
            z-index: 5;
            touch-action: manipulation;
        }

        .specimen:hover, .specimen:active {
            transform: scale(1.4);
            filter: brightness(1.3);
        }

        /* Mobile specimen sizing */
        @media (max-width: 768px) {
            .specimen {
                width: 40px;
                height: 40px;
            }
            
            .specimen:active {
                transform: scale(1.6);
            }
        }

        .bacteria { 
            background: radial-gradient(circle, #ff6b6b, #ee5a52);
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 0 15px rgba(255,107,107,0.6);
        }

        .bacteria::before {
            content: '🧬';
            position: absolute;
            font-size: 16px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            animation: dnaRotate 3s linear infinite;
        }

        .virus { 
            background: radial-gradient(circle, #4ecdc4, #45b7d1);
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 0 15px rgba(78,205,196,0.6);
        }

        .virus::before {
            content: '⚛️';
            position: absolute;
            font-size: 14px;
            left: 50%;
            top: 60%;
            transform: translate(-50%, -50%);
        }

        .algae { 
            background: radial-gradient(circle, #45b7d1, #2980b9);
            border-radius: 50% 10% 50% 10%;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 0 15px rgba(69,183,209,0.6);
            animation: algaeWiggle 2s ease-in-out infinite;
        }

        .algae::before {
            content: '🌱';
            position: absolute;
            font-size: 16px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .plankton { 
            background: radial-gradient(circle, #96ceb4, #74b9ff);
            border-radius: 70% 30% 70% 30%;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 0 15px rgba(150,206,180,0.6);
            position: relative;
        }

        .plankton::before {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
            top: 8px;
            left: 8px;
        }

        .plankton::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 12px;
            background: rgba(255,255,255,0.6);
            border-radius: 50%;
            top: 18px;
            left: 6px;
            animation: tentacleWave 1.5s ease-in-out infinite;
        }

        .microbe { 
            background: radial-gradient(circle, #feca57, #ff9ff3);
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.4);
            box-shadow: 0 0 20px rgba(254,202,87,0.8);
            position: relative;
        }

        .microbe::before {
            content: '🦠';
            position: absolute;
            font-size: 18px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes algaeWiggle {
            0%, 100% { border-radius: 50% 10% 50% 10%; }
            50% { border-radius: 10% 50% 10% 50%; }
        }

        @keyframes tentacleWave {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(15deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        @keyframes dnaRotate {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .waves {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 120px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.2) 25%, 
                rgba(135,206,235,0.3) 50%, 
                rgba(255,255,255,0.2) 75%, 
                transparent 100%);
            animation: wave 4s linear infinite;
            border-radius: 50% 50% 0 0;
        }

        .waves::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            height: 80px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.1) 30%, 
                rgba(70,130,180,0.2) 50%, 
                rgba(255,255,255,0.1) 70%, 
                transparent 100%);
            animation: wave 6s linear infinite reverse;
            border-radius: 50% 50% 0 0;
        }

        .waves::after {
            content: '';
            position: absolute;
            top: 40px;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.05) 40%, 
                rgba(100,149,237,0.1) 50%, 
                rgba(255,255,255,0.05) 60%, 
                transparent 100%);
            animation: wave 8s linear infinite;
            border-radius: 50% 50% 0 0;
        }

        @keyframes wave {
            0% { transform: translateX(-50%); }
            100% { transform: translateX(0%); }
        }

        .craig-avatar {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 0 8px 25px rgba(0,0,0,0.6);
            animation: avatarPulse 3s ease-in-out infinite;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            touch-action: manipulation;
            z-index: 100;
        }

        /* Mobile craig avatar */
        @media (max-width: 768px) {
            .craig-avatar {
                top: 60px;
                right: 10px;
                width: 70px;
                height: 70px;
                border: 3px solid #fff;
                font-size: 40px;
            }
        }

        @keyframes avatarPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 8px 25px rgba(0,0,0,0.5); }
            50% { transform: scale(1.05); box-shadow: 0 10px 30px rgba(102,126,234,0.4); }
        }

        .stats {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        /* Mobile stats */
        @media (max-width: 768px) {
            .stats {
                padding: 12px;
                margin-bottom: 15px;
            }
            
            .stat-item {
                font-size: 14px;
                margin-bottom: 6px;
            }
        }

        .button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
            -webkit-appearance: none;
        }

        .button:hover, .button:active {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Mobile button styling */
        @media (max-width: 768px) {
            .button {
                padding: 15px;
                font-size: 15px;
                margin: 10px 0;
            }
            
            .button:active {
                transform: scale(0.98);
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            }
        }

        .lab-panel {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .research-request {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            animation: requestPulse 2s ease-in-out infinite;
        }

        @keyframes requestPulse {
            0%, 100% { border-color: #ffc107; }
            50% { border-color: #ff6b6b; }
        }

        .specimen-categories {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            font-size: 14px;
        }

        /* Mobile category styling */
        @media (max-width: 768px) {
            .category-grid {
                grid-template-columns: 1fr;
                gap: 5px;
            }
            
            .category-item {
                font-size: 13px;
                padding: 8px;
            }
            
            .research-request {
                padding: 12px;
                font-size: 14px;
            }
        }

        .sequencer-machine {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #3498db;
            box-shadow: 0 5px 20px rgba(52,152,219,0.3);
            position: relative;
            overflow: hidden;
        }

        .sequencer-machine::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(52,152,219,0.2), transparent);
            animation: sequencerScan 3s linear infinite;
        }

        @keyframes sequencerScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .sequencer-display {
            background: #000;
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-bottom: 10px;
            border: 1px solid #00ff00;
            box-shadow: inset 0 0 10px rgba(0,255,0,0.2);
        }

        .dna-helix {
            display: inline-block;
            animation: dnaRotate 2s linear infinite;
        }

        .specimen-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            -webkit-overflow-scrolling: touch;
        }

        .specimen-item {
            background: rgba(255,255,255,0.1);
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s ease;
            touch-action: manipulation;
        }

        .specimen-item:hover, .specimen-item:active {
            background: rgba(255,255,255,0.2);
        }

        /* Mobile specimen list */
        @media (max-width: 768px) {
            .specimen-list {
                max-height: 150px;
            }
            
            .specimen-item {
                padding: 10px;
                font-size: 14px;
            }
        }

        .discovery-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 1000;
            text-align: center;
            max-width: 400px;
            display: none;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 999;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #45b7d1);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .coordinates {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 10px;
        }

        .wave-splash {
            position: absolute;
            width: 100%;
            height: 60px;
            bottom: 80px;
            left: 0;
            background: linear-gradient(90deg, 
                transparent 0%,
                rgba(255,255,255,0.4) 20%,
                rgba(135,206,235,0.6) 40%,
                rgba(255,255,255,0.5) 60%,
                rgba(70,130,180,0.4) 80%,
                transparent 100%);
            border-radius: 50% 50% 0 0;
            animation: splash 3s ease-in-out infinite;
            opacity: 0;
        }

        .wave-splash.active {
            opacity: 1;
        }

        @keyframes splash {
            0%, 100% { transform: scaleY(0.5) translateY(20px); opacity: 0; }
            50% { transform: scaleY(1.2) translateY(-10px); opacity: 1; }
        }

        .storm-effects {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .storm-effects.active {
            opacity: 1;
        }

        .lightning {
            position: absolute;
            width: 2px;
            height: 100%;
            background: linear-gradient(to bottom, #fff, #87ceeb, transparent);
            animation: lightning 0.1s ease-in-out;
            opacity: 0;
        }

        @keyframes lightning {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .rain {
            position: absolute;
            width: 1px;
            height: 10px;
            background: rgba(255,255,255,0.6);
            animation: rain 1s linear infinite;
        }

        @keyframes rain {
            0% { transform: translateY(-10px); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(100vh); opacity: 0; }
        }

        .pirate-ship {
            position: absolute;
            width: 120px;
            height: 80px;
            background: linear-gradient(180deg, #4a4a4a 0%, #2c2c2c 100%);
            border-radius: 60px 60px 8px 8px;
            z-index: 15;
            animation: pirateApproach 5s ease-in-out;
        }

        .pirate-ship::before {
            content: '🏴‍☠️';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            animation: pirateFlag 1s ease-in-out infinite;
        }

        .pirate-ship::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 40px;
            background: #654321;
            left: 50%;
            top: -35px;
            transform: translateX(-50%);
        }

        @keyframes pirateApproach {
            0% { right: -150px; transform: rotate(-10deg); }
            50% { right: 200px; transform: rotate(5deg); }
            100% { right: -150px; transform: rotate(-10deg); }
        }

        @keyframes pirateFlag {
            0%, 100% { transform: translateX(-50%) rotate(-5deg); }
            50% { transform: translateX(-50%) rotate(5deg); }
        }

        .ship-damage {
            animation: shipShake 0.5s ease-in-out infinite;
        }

        @keyframes shipShake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-48%, -52%) rotate(-2deg); }
            75% { transform: translate(-52%, -48%) rotate(2deg); }
        }

        .health-critical {
            color: #ff4757 !important;
            animation: healthBlink 1s ease-in-out infinite;
        }

        @keyframes healthBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .storm-warning {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #ff4757, #ff3838);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 5px 20px rgba(255, 71, 87, 0.4);
            z-index: 200;
            animation: warningPulse 1s ease-in-out infinite;
        }

        @keyframes warningPulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
        }

        .shark {
            position: absolute;
            width: 80px;
            height: 40px;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #2c3e50 100%);
            border-radius: 0 50px 30px 50px;
            z-index: 12;
            animation: sharkSwim 4s ease-in-out;
        }

        .shark::before {
            content: '🦈';
            position: absolute;
            top: -5px;
            left: 10px;
            font-size: 28px;
            animation: sharkBite 0.5s ease-in-out infinite;
        }

        .shark::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 15px solid #34495e;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            right: -10px;
            top: 12px;
        }

        @keyframes sharkSwim {
            0% { left: -100px; transform: rotate(0deg); }
            25% { left: 300px; transform: rotate(-5deg); }
            50% { left: 600px; transform: rotate(5deg); }
            75% { left: 300px; transform: rotate(-5deg); }
            100% { left: -100px; transform: rotate(0deg); }
        }

        @keyframes sharkBite {
            0%, 100% { transform: scale(1) rotate(-5deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        .blood-effect {
            position: absolute;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, rgba(220, 53, 69, 0.8), transparent);
            border-radius: 50%;
            animation: bloodSpread 2s ease-out;
            pointer-events: none;
        }

        @keyframes bloodSpread {
            0% { 
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            100% { 
                transform: scale(3) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1 class="title">
                <div class="title-main">THE VOYAGE</div>
                <div class="title-of">of</div>
                <div class="title-sorcerer">SORCERER II</div>
            </h1>
            <p class="subtitle">The expedition that unlocked the secrets of the ocean's microbiome</p>
        </div>
        
        <div class="game-area">
            <div class="ocean-view">
                <div class="ocean-info">
                    <div><strong>Current Location:</strong> <span id="location">Sargasso Sea</span></div>
                    <div class="coordinates">Lat: <span id="lat">32.0°N</span>, Lon: <span id="lon">64.0°W</span></div>
                    <div><strong>Depth:</strong> <span id="depth">50m</span></div>
                    <div><strong>Temperature:</strong> <span id="temp">24°C</span></div>
                </div>
                
                <div class="craig-avatar" onclick="craigSpeaks()" title="Dr. Craig Venter - Click for insights">
                    👨‍🔬
                </div>
                
                <div class="ship" id="ship">
                    <div class="ship-hull"></div>
                    <div class="ship-deck"></div>
                    <div class="ship-cabin"></div>
                    <div class="ship-mast-main"></div>
                    <div class="ship-mast-front"></div>
                    <div class="ship-sail-main"></div>
                    <div class="ship-sail-front"></div>
                    <div class="ship-equipment"></div>
                    <div class="ship-antenna"></div>
                </div>
                
                <div class="waves"></div>
                <div class="wave-splash" id="wave-splash"></div>
                <div class="storm-effects" id="storm-effects"></div>
            </div>
            
            <div class="controls-panel">
                <div class="stats">
                    <h3>🚢 Expedition Status</h3>
                    <div class="stat-item">
                        <span>Specimens Collected:</span>
                        <span id="specimens-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Genes Sequenced:</span>
                        <span id="genes-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span>New Species Found:</span>
                        <span id="species-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Papers Published:</span>
                        <span id="papers-published">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Papers Rejected:</span>
                        <span id="papers-rejected">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Funding Remaining:</span>
                        <span id="funding">$2,000,000</span>
                    </div>
                    <div class="stat-item">
                        <span>Ship Health:</span>
                        <span id="ship-health" style="color: #4ecdc4;">100%</span>
                    </div>
                    <div class="stat-item">
                        <span>Insurance:</span>
                        <span id="insurance-status">❌ None</span>
                    </div>
                </div>
                
                <button class="button" onclick="dropNet()">🕸️ Deploy Collection Net</button>
                <button class="button" onclick="navigate()">🧭 Navigate to New Waters</button>
                <button class="button" onclick="deepDive()">🌊 Deep Sea Dive</button>
                <button class="button" onclick="purchaseInsurance()" id="insurance-btn">🛡️ Buy Ship Insurance ($100k)</button>
                <button class="button" onclick="repairShip()" id="repair-btn" style="display: none;">🔧 Repair Ship ($50k)</button>
                
                <div class="lab-panel">
                    <h3>🔬 Genomics Laboratory</h3>
                    
                    <div id="research-request" class="research-request" style="display: none;">
                        <h4>📋 Research Request</h4>
                        <p id="request-text"></p>
                        <div class="request-progress">
                            <span id="request-progress-text"></span>
                        </div>
                    </div>
                    
                    <div class="specimen-categories">
                        <h4>📊 Specimen Categories</h4>
                        <div class="category-grid">
                            <div class="category-item">
                                <span>🦠 Bacteria:</span>
                                <span id="bacteria-count">0</span>
                            </div>
                            <div class="category-item">
                                <span>🦠 Viruses:</span>
                                <span id="virus-count">0</span>
                            </div>
                            <div class="category-item">
                                <span>🌱 Algae:</span>
                                <span id="algae-count">0</span>
                            </div>
                            <div class="category-item">
                                <span>🦠 Protozoa:</span>
                                <span id="protozoa-count">0</span>
                            </div>
                            <div class="category-item">
                                <span>🔬 Unknown:</span>
                                <span id="microbe-count">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sequencer-machine" id="sequencer" style="display: none;">
                        <div class="sequencer-display" id="sequencer-display">
                            <div>DNA SEQUENCER v3.7 - INITIALIZING...</div>
                            <div>Loading genetic analysis protocols...</div>
                            <div>Status: <span class="dna-helix">🧬</span> PROCESSING</div>
                        </div>
                        <div style="text-align: center; color: #3498db; font-weight: bold;">
                            Illumina HiSeq System Active
                        </div>
                    </div>
                    
                    <button class="button" onclick="processSpecimens()" id="process-btn" disabled>
                        🧬 Sequence DNA (0 specimens ready)
                    </button>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress" style="width: 0%"></div>
                    </div>
                    
                    <div class="specimen-list" id="specimen-list">
                        <em>No specimens collected yet...</em>
                    </div>
                </div>
                
                <button class="button" onclick="publishFindings()">📊 Publish Research Paper</button>
            </div>
        </div>
    </div>
    
    <div class="popup-overlay" id="popup-overlay" onclick="closePopup()"></div>
    <div class="discovery-popup" id="discovery-popup">
        <h2 id="popup-title">🎉 Major Discovery!</h2>
        <p id="popup-message"></p>
        <button class="button" onclick="closePopup()">Continue Research</button>
    </div>

    <script>
        // Game state and data
        const gameState = {
            specimens: [],
            genesSequenced: 0,
            speciesFound: 0,
            breakthroughs: 0,
            funding: 2000000,
            currentLocation: 'Sargasso Sea',
            depth: 50,
            coordinates: { lat: 32.0, lon: -64.0 },
            temperature: 24,
            expeditionProgress: 0,
            specimenCounts: {
                bacteria: 0,
                virus: 0,
                algae: 0,
                plankton: 0,
                microbe: 0,
                protozoa: 0
            },
            currentRequest: null,
            papersRejected: 0,
            papersPublished: 0,
            shipHealth: 100,
            insurance: false,
            lastEventTime: 0
        };

        const locations = [
            { name: 'Sargasso Sea', lat: 32.0, lon: -64.0, temp: 24 },
            { name: 'Galapagos Islands', lat: -0.7, lon: -91.1, temp: 22 },
            { name: 'Great Barrier Reef', lat: -16.3, lon: 145.8, temp: 26 },
            { name: 'Mariana Trench', lat: 11.4, lon: 142.2, temp: 4 },
            { name: 'Mediterranean Sea', lat: 35.0, lon: 18.0, temp: 20 },
            { name: 'Arctic Ocean', lat: 85.0, lon: 0.0, temp: -1 }
        ];

        const specimenTypes = [
            { type: 'bacteria', name: 'Marine Bacteria', class: 'bacteria', rarity: 0.7, category: 'Bacteria' },
            { type: 'virus', name: 'Ocean Virus', class: 'virus', rarity: 0.5, category: 'Virus' },
            { type: 'algae', name: 'Photosynthetic Algae', class: 'algae', rarity: 0.6, category: 'Algae' },
            { type: 'plankton', name: 'Zooplankton', class: 'plankton', rarity: 0.4, category: 'Protozoa' },
            { type: 'microbe', name: 'Unknown Microbe', class: 'microbe', rarity: 0.2, category: 'Microbe' },
            { type: 'protozoa', name: 'Marine Protozoa', class: 'plankton', rarity: 0.3, category: 'Protozoa' }
        ];

        const craigQuotes = [
            "The future of medicine lies in understanding the genetic blueprints of our oceans!",
            "Every drop of seawater contains thousands of unknown species. We're just beginning to scratch the surface.",
            "This genomic data could revolutionize how we approach climate change and human health.",
            "We're not just collecting specimens - we're collecting the future of biotechnology.",
            "The ocean's genetic diversity holds keys to solving humanity's greatest challenges.",
            "Each new genome we sequence brings us closer to breakthrough discoveries.",
            "The Sorcerer II isn't just a boat - it's a floating laboratory for the genetic revolution!"
        ];

        const researchRequests = [
            { type: 'bacteria', target: 5, description: 'Marine biologist needs 5 bacterial specimens for antibiotic resistance study', reward: 100000 },
            { type: 'virus', target: 3, description: 'Virologist requesting 3 ocean viruses for climate change research', reward: 150000 },
            { type: 'protozoa', target: 4, description: 'Protozoologist needs 4 protozoan samples for evolutionary study', reward: 120000 },
            { type: 'algae', target: 6, description: 'Biotechnologist requesting 6 algae specimens for biofuel development', reward: 200000 },
            { type: 'microbe', target: 2, description: 'Unknown microbes needed for breakthrough pharmaceutical research', reward: 300000 }
        ];

        const rejectionReasons = [
            "Reviewer 2 demands more genomic evidence. Additional sequencing data required.",
            "Editorial board requests deeper phylogenetic analysis of specimens.",
            "Peer reviewers question sample diversity. More specimens from different locations needed.",
            "Statistical significance concerns raised. Larger sample size required.",
            "Novel findings need independent validation. Replicate studies necessary.",
            "Methodology section needs clarification on de Bruijn graph assembly parameters.",
            "Control experiments missing. Comparative analysis with known species required."
        ];

        const discoveries = [
            "New antibiotic-producing bacteria discovered! Potential treatment for drug-resistant infections.",
            "Novel enzyme found that breaks down plastic pollutants in ocean water!",
            "Extremophile bacteria reveals secrets of surviving in harsh climates.",
            "Photosynthetic organism with 50% higher efficiency could revolutionize biofuel production.",
            "Unique viral protein shows promise for targeted cancer therapy.",
            "Deep-sea microbe produces compounds that could slow aging processes.",
            "Marine algae genome reveals pathway for carbon dioxide sequestration.",
            "Symbiotic bacteria relationship discovered that enhances coral reef resilience."
        ];

        const sequences = [
            'ATCGATCGTAGCTACGTACG...',
            'GCTAGCTAGCTGACTAGCTA...',
            'TAGCTAGCATGCATGCATGC...',
            'TTTTTTTTTTTTTTTTTTTT...',
            'GCGCGCGCGCGCGCGCGCGC...',
            'AAAAAATAAAAAAATAAAAA...',
            'CCCCCCCCCCCCCCCCCCC...',
            'GCGCGGCGCGCGGCGCGCGG...',
            'ATATATATATATATATATA...',
            'GGGGGGGGGGGGGGGGGGG...'
        ];

        // Core game functions
        function updateDisplay() {
            document.getElementById('specimens-count').textContent = gameState.specimens.length;
            document.getElementById('genes-count').textContent = gameState.genesSequenced;
            document.getElementById('species-count').textContent = gameState.speciesFound;
            document.getElementById('papers-published').textContent = gameState.papersPublished;
            document.getElementById('papers-rejected').textContent = gameState.papersRejected;
            document.getElementById('funding').textContent = `$${gameState.funding.toLocaleString()}`;
            document.getElementById('location').textContent = gameState.currentLocation;
            document.getElementById('lat').textContent = `${Math.abs(gameState.coordinates.lat).toFixed(1)}°${gameState.coordinates.lat >= 0 ? 'N' : 'S'}`;
            document.getElementById('lon').textContent = `${Math.abs(gameState.coordinates.lon).toFixed(1)}°${gameState.coordinates.lon >= 0 ? 'E' : 'W'}`;
            document.getElementById('depth').textContent = `${gameState.depth}m`;
            document.getElementById('temp').textContent = `${gameState.temperature}°C`;
            
            // Update ship health display
            const shipHealthEl = document.getElementById('ship-health');
            shipHealthEl.textContent = `${gameState.shipHealth}%`;
            if (gameState.shipHealth < 30) {
                shipHealthEl.className = 'health-critical';
                shipHealthEl.style.color = '#ff4757';
            } else if (gameState.shipHealth < 60) {
                shipHealthEl.style.color = '#ffa502';
            } else {
                shipHealthEl.style.color = '#4ecdc4';
                shipHealthEl.className = '';
            }
            
            // Update insurance status
            document.getElementById('insurance-status').textContent = gameState.insurance ? '✅ Active' : '❌ None';
            
            // Update repair button visibility
            const repairBtn = document.getElementById('repair-btn');
            repairBtn.style.display = gameState.shipHealth < 100 ? 'block' : 'none';
            
            // Update insurance button
            const insuranceBtn = document.getElementById('insurance-btn');
            if (gameState.insurance) {
                insuranceBtn.textContent = '🛡️ Insurance Active';
                insuranceBtn.disabled = true;
            } else {
                insuranceBtn.textContent = '🛡️ Buy Ship Insurance ($100k)';
                insuranceBtn.disabled = gameState.funding < 100000;
            }
            
            // Update specimen category counts
            document.getElementById('bacteria-count').textContent = gameState.specimenCounts.bacteria;
            document.getElementById('virus-count').textContent = gameState.specimenCounts.virus;
            document.getElementById('algae-count').textContent = gameState.specimenCounts.algae;
            document.getElementById('protozoa-count').textContent = gameState.specimenCounts.protozoa + gameState.specimenCounts.plankton;
            document.getElementById('microbe-count').textContent = gameState.specimenCounts.microbe;
            
            const processBtn = document.getElementById('process-btn');
            const unprocessedCount = gameState.specimens.filter(s => !s.processed).length;
            processBtn.textContent = `🧬 Sequence DNA (${unprocessedCount} specimens ready)`;
            processBtn.disabled = unprocessedCount === 0;
            
            updateProgress();
            updateSpecimenList();
            updateResearchRequest();
        }

        function updateProgress() {
            const progress = Math.min((gameState.genesSequenced / 1000) * 100, 100);
            document.getElementById('progress').style.width = `${progress}%`;
        }

        function updateSpecimenList() {
            const list = document.getElementById('specimen-list');
            if (gameState.specimens.length === 0) {
                list.innerHTML = '<em>No specimens collected yet...</em>';
                return;
            }
            
            list.innerHTML = gameState.specimens.map((specimen, index) => 
                `<div class="specimen-item">
                    <strong>${specimen.name}</strong><br>
                    <small>${specimen.processed ? '✅ Sequenced' : '⏳ Awaiting analysis'}</small>
                </div>`
            ).join('');
        }

        function dropNet() {
            if (gameState.funding < 10000) {
                showPopup('Insufficient Funding', 'Not enough funding for specimen collection. Publish research to secure more grants!');
                return;
            }
            
            gameState.funding -= 10000;
            
            // Clear existing specimens from ocean
            document.querySelectorAll('.specimen').forEach(el => el.remove());
            
            // Generate new specimens based on location
            const numSpecimens = Math.floor(Math.random() * 8) + 3;
            
            for (let i = 0; i < numSpecimens; i++) {
                setTimeout(() => {
                    createSpecimen();
                }, i * 200);
            }
            
            updateDisplay();
        }

        function createSpecimen() {
            const specimen = document.createElement('div');
            const specimenType = specimenTypes[Math.floor(Math.random() * specimenTypes.length)];
            
            specimen.className = `specimen ${specimenType.class}`;
            specimen.style.left = `${Math.random() * 80 + 10}%`;
            specimen.style.top = `${Math.random() * 70 + 15}%`;
            specimen.style.animationDelay = `${Math.random() * 3}s`;
            
            specimen.onclick = () => collectSpecimen(specimen, specimenType);
            
            document.querySelector('.ocean-view').appendChild(specimen);
        }

        function collectSpecimen(element, specimenType) {
            element.remove();
            
            const newSpecimen = {
                name: specimenType.name,
                type: specimenType.type,
                rarity: specimenType.rarity,
                processed: false,
                location: gameState.currentLocation,
                depth: gameState.depth
            };
            
            gameState.specimens.push(newSpecimen);
            gameState.specimenCounts[specimenType.type]++;
            updateDisplay();
            
            // Check if this completes a research request
            checkResearchRequest();
        }

        function processSpecimens() {
            const unprocessed = gameState.specimens.filter(s => !s.processed);
            if (unprocessed.length === 0) return;
            
            if (gameState.funding < 50000) {
                showPopup('Insufficient Funding', 'DNA sequencing requires $50,000. Seek additional funding!');
                return;
            }
            
            gameState.funding -= 50000;
            
            // Show sequencer machine
            const sequencer = document.getElementById('sequencer');
            const display = document.getElementById('sequencer-display');
            sequencer.style.display = 'block';
            
            // Animate sequencing process
            let sequenceIndex = 0;
            const sequenceInterval = setInterval(() => {
                display.innerHTML = `
                    <div>DNA SEQUENCER v3.7 - ACTIVE</div>
                    <div>Sequence ${sequenceIndex + 1}/${unprocessed.length}: ${sequences[sequenceIndex % sequences.length]}</div>
                    <div>Status: <span class="dna-helix">🧬</span> PROCESSING</div>
                `;
                sequenceIndex++;
                
                if (sequenceIndex >= unprocessed.length) {
                    clearInterval(sequenceInterval);
                    setTimeout(() => {
                        sequencer.style.display = 'none';
                    }, 1000);
                }
            }, 1000);
            
            unprocessed.forEach(specimen => {
                specimen.processed = true;
                gameState.genesSequenced += Math.floor(Math.random() * 500) + 100;
                
                if (Math.random() < specimen.rarity) {
                    gameState.speciesFound++;
                    
                    if (Math.random() < 0.3) {
                        gameState.breakthroughs++;
                        const discovery = discoveries[Math.floor(Math.random() * discoveries.length)];
                        setTimeout(() => {
                            showPopup('Research Breakthrough!', discovery);
                        }, 2000);
                    }
                }
            });
            
            updateDisplay();
        }

        function navigate() {
            if (gameState.funding < 25000) {
                showPopup('Insufficient Funding', 'Navigation and fuel costs require $25,000.');
                return;
            }
            
            gameState.funding -= 25000;
            
            // Create dramatic ocean effects
            createOceanEffects();
            
            const newLocation = locations[Math.floor(Math.random() * locations.length)];
            gameState.currentLocation = newLocation.name;
            gameState.coordinates = { lat: newLocation.lat, lon: newLocation.lon };
            gameState.temperature = newLocation.temp;
            gameState.depth = Math.floor(Math.random() * 500) + 10;
            
            // Clear existing specimens
            document.querySelectorAll('.specimen').forEach(el => el.remove());
            
            // Check for random events during navigation
            checkRandomEvents();
            
            updateDisplay();
        }

        function deepDive() {
            if (gameState.funding < 75000) {
                showPopup('Insufficient Funding', 'Deep sea exploration requires $75,000 for specialized equipment.');
                return;
            }
            
            gameState.funding -= 75000;
            gameState.depth = Math.floor(Math.random() * 2000) + 500;
            gameState.temperature = Math.max(gameState.temperature - 15, 2);
            
            // Deep sea specimens are rarer but more valuable
            const numSpecimens = Math.floor(Math.random() * 4) + 2;
            
            for (let i = 0; i < numSpecimens; i++) {
                setTimeout(() => {
                    const specimen = document.createElement('div');
                    specimen.className = 'specimen microbe';
                    specimen.style.left = `${Math.random() * 80 + 10}%`;
                    specimen.style.top = `${Math.random() * 70 + 15}%`;
                    specimen.style.animationDelay = `${Math.random() * 3}s`;
                    
                    specimen.onclick = () => {
                        specimen.remove();
                        gameState.specimens.push({
                            name: 'Deep Sea Extremophile',
                            type: 'extremophile',
                            rarity: 0.8,
                            processed: false,
                            location: gameState.currentLocation,
                            depth: gameState.depth
                        });
                        gameState.specimenCounts.microbe++;
                        updateDisplay();
                        checkResearchRequest();
                    };
                    
                    document.querySelector('.ocean-view').appendChild(specimen);
                }, i * 300);
            }
            
            updateDisplay();
        }

        function publishFindings() {
            if (gameState.genesSequenced < 100) {
                showPopup('Insufficient Data', 'You need at least 100 sequenced genes to publish meaningful research.');
                return;
            }
            
            // Check for paper rejection (30% chance if not enough specimens/genes)
            const rejectionChance = Math.max(0.3 - (gameState.genesSequenced / 2000), 0.1);
            
            if (Math.random() < rejectionChance) {
                gameState.papersRejected++;
                const reason = rejectionReasons[Math.floor(Math.random() * rejectionReasons.length)];
                showPopup('Paper Rejected!', `❌ Your submission to Nature has been rejected.\n\n"${reason}"\n\nKeep collecting data and try again!`);
                updateDisplay();
                return;
            }
            
            // Successful publication
            gameState.papersPublished++;
            const grantAmount = gameState.breakthroughs * 500000 + gameState.speciesFound * 100000 + Math.floor(gameState.genesSequenced / 100) * 50000;
            gameState.funding += grantAmount;
            
            showPopup('Research Published!', 
                `✅ Your groundbreaking research has been published in Nature! 
                Grant funding received: $${grantAmount.toLocaleString()}
                
                "Dr. Venter's expedition has revolutionized our understanding of marine genomics and opened new frontiers in biotechnology."`);
            
            // Generate new research request occasionally
            if (Math.random() < 0.4 && !gameState.currentRequest) {
                generateResearchRequest();
            }
            
            updateDisplay();
        }

        function createOceanEffects() {
            // Activate wave splash
            const splash = document.getElementById('wave-splash');
            splash.classList.add('active');
            setTimeout(() => splash.classList.remove('active'), 3000);
            
            // Create storm effect occasionally
            if (Math.random() < 0.4) {
                setTimeout(() => createStormEffect(), 1000);
            }
        }

        function craigSpeaks() {
            const quote = craigQuotes[Math.floor(Math.random() * craigQuotes.length)];
            showPopup('Dr. Craig Venter says:', `"${quote}"`);
        }

        function createStormEffect() {
            const stormContainer = document.getElementById('storm-effects');
            stormContainer.classList.add('active');
            
            // Create lightning
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const lightning = document.createElement('div');
                    lightning.className = 'lightning';
                    lightning.style.left = `${Math.random() * 100}%`;
                    stormContainer.appendChild(lightning);
                    
                    setTimeout(() => lightning.remove(), 200);
                }, i * 300);
            }
            
            // Create rain
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const rain = document.createElement('div');
                    rain.className = 'rain';
                    rain.style.left = `${Math.random() * 100}%`;
                    rain.style.animationDelay = `${Math.random() * 1}s`;
                    stormContainer.appendChild(rain);
                    
                    setTimeout(() => rain.remove(), 1000);
                }, i * 20);
            }
            
            setTimeout(() => {
                stormContainer.classList.remove('active');
            }, 2000);
        }

        function showPopup(title, message) {
            document.getElementById('popup-title').textContent = title;
            document.getElementById('popup-message').textContent = message;
            document.getElementById('popup-overlay').style.display = 'block';
            document.getElementById('discovery-popup').style.display = 'block';
        }

        function closePopup() {
            document.getElementById('popup-overlay').style.display = 'none';
            document.getElementById('discovery-popup').style.display = 'none';
        }

        function generateResearchRequest() {
            const request = researchRequests[Math.floor(Math.random() * researchRequests.length)];
            gameState.currentRequest = { ...request, collected: 0 };
            updateDisplay();
        }

        function updateResearchRequest() {
            const requestDiv = document.getElementById('research-request');
            if (gameState.currentRequest) {
                requestDiv.style.display = 'block';
                document.getElementById('request-text').textContent = gameState.currentRequest.description;
                document.getElementById('request-progress-text').textContent = 
                    `Progress: ${gameState.currentRequest.collected}/${gameState.currentRequest.target} specimens`;
            } else {
                requestDiv.style.display = 'none';
            }
        }

        function checkResearchRequest() {
            if (!gameState.currentRequest) return;
            
            const currentCount = gameState.specimenCounts[gameState.currentRequest.type] || 0;
            gameState.currentRequest.collected = currentCount;
            
            if (currentCount >= gameState.currentRequest.target) {
                const reward = gameState.currentRequest.reward;
                gameState.funding += reward;
                showPopup('Research Request Completed!', 
                    `🎉 You've successfully completed the research request!\n\nReward: ${reward.toLocaleString()}\n\nThe scientific community thanks you for your contribution!`);
                gameState.currentRequest = null;
            }
        }

        // New challenging event system
        function checkRandomEvents() {
            const currentTime = Date.now();
            if (currentTime - gameState.lastEventTime < 30000) return; // 30 second cooldown
            
            const eventChance = Math.random();
            
            if (eventChance < 0.25) { // 25% chance
                gameState.lastEventTime = currentTime;
                
                const randomEvent = Math.random();
                if (randomEvent < 0.4) {
                    triggerStorm();
                } else if (randomEvent < 0.7) {
                    triggerPirateAttack();
                } else {
                    triggerSharkAttack();
                }
            }
        }

        function triggerStorm() {
            showWarning('⛈️ SEVERE STORM APPROACHING!');
            
            setTimeout(() => {
                createMassiveStorm();
                
                const damage = Math.floor(Math.random() * 40) + 20; // 20-60% damage
                const specimenLoss = Math.floor(Math.random() * 5) + 2; // Lose 2-6 specimens
                const fundingLoss = Math.floor(Math.random() * 200000) + 100000; // $100k-300k
                
                // Apply damage
                gameState.shipHealth = Math.max(0, gameState.shipHealth - damage);
                
                // Lose specimens
                const lostSpecimens = gameState.specimens.splice(0, Math.min(specimenLoss, gameState.specimens.length));
                lostSpecimens.forEach(specimen => {
                    if (gameState.specimenCounts[specimen.type]) {
                        gameState.specimenCounts[specimen.type]--;
                    }
                });
                
                // Insurance coverage
                let actualFundingLoss = fundingLoss;
                if (gameState.insurance) {
                    actualFundingLoss = Math.floor(fundingLoss * 0.3); // Insurance covers 70%
                    gameState.insurance = false; // Insurance is used up
                }
                
                gameState.funding = Math.max(0, gameState.funding - actualFundingLoss);
                
                // Add ship damage animation
                document.getElementById('ship').classList.add('ship-damage');
                setTimeout(() => {
                    document.getElementById('ship').classList.remove('ship-damage');
                }, 3000);
                
                const insuranceText = gameState.insurance ? 
                    `\n\n🛡️ Insurance covered 70% of financial losses!` : 
                    `\n\n💡 Ship insurance could have reduced these losses!`;
                
                showPopup('Storm Damage Report!', 
                    `⛈️ A massive storm has battered the Sorcerer II!\n\n` +
                    `🚢 Ship Health: -${damage}%\n` +
                    `🧪 Specimens Lost: ${lostSpecimens.length}\n` +
                    `💰 Emergency Costs: ${actualFundingLoss.toLocaleString()}` +
                    insuranceText);
                
                updateDisplay();
            }, 3000);
        }

        function triggerPirateAttack() {
            showWarning('🏴‍☠️ PIRATE SHIP SPOTTED!');
            
            // Show pirate ship animation
            const pirateShip = document.createElement('div');
            pirateShip.className = 'pirate-ship';
            document.querySelector('.ocean-view').appendChild(pirateShip);
            
            setTimeout(() => {
                pirateShip.remove();
                
                const stolenMoney = Math.floor(Math.random() * 300000) + 150000; // $150k-450k
                const stolenSpecimens = Math.floor(Math.random() * 8) + 3; // 3-10 specimens
                const shipDamage = Math.floor(Math.random() * 25) + 10; // 10-35% damage
                
                // Lose specimens
                const lostSpecimens = gameState.specimens.splice(0, Math.min(stolenSpecimens, gameState.specimens.length));
                lostSpecimens.forEach(specimen => {
                    if (gameState.specimenCounts[specimen.type]) {
                        gameState.specimenCounts[specimen.type]--;
                    }
                });
                
                // Apply damage and losses
                gameState.shipHealth = Math.max(0, gameState.shipHealth - shipDamage);
                
                let actualMoneyLoss = stolenMoney;
                if (gameState.insurance) {
                    actualMoneyLoss = Math.floor(stolenMoney * 0.4); // Insurance covers 60%
                    gameState.insurance = false;
                }
                
                gameState.funding = Math.max(0, gameState.funding - actualMoneyLoss);
                
                // Add ship damage animation
                document.getElementById('ship').classList.add('ship-damage');
                setTimeout(() => {
                    document.getElementById('ship').classList.remove('ship-damage');
                }, 3000);
                
                const insuranceText = gameState.insurance ? 
                    `\n\n🛡️ Insurance covered 60% of stolen funds!` : 
                    `\n\n💡 Ship insurance could have reduced these losses!`;
                
                showPopup('Pirate Attack!', 
                    `🏴‍☠️ Pirates have attacked the Sorcerer II!\n\n` +
                    `"Arrr! We'll be takin' yer research treasures!"\n\n` +
                    `🚢 Ship Damage: -${shipDamage}%\n` +
                    `🧪 Specimens Stolen: ${lostSpecimens.length}\n` +
                    `💰 Funds Stolen: ${actualMoneyLoss.toLocaleString()}` +
                    insuranceText);
                
                updateDisplay();
            }, 5000);
        }

        function triggerSharkAttack() {
            showWarning('🦈 SHARK SPOTTED IN THE WATER!');
            
            // Show shark animation
            const shark = document.createElement('div');
            shark.className = 'shark';
            document.querySelector('.ocean-view').appendChild(shark);
            
            // Create blood effects during attack
            setTimeout(() => {
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const blood = document.createElement('div');
                        blood.className = 'blood-effect';
                        blood.style.left = `${Math.random() * 60 + 20}%`;
                        blood.style.top = `${Math.random() * 40 + 40}%`;
                        document.querySelector('.ocean-view').appendChild(blood);
                        
                        setTimeout(() => blood.remove(), 2000);
                    }, i * 300);
                }
            }, 2000);
            
            setTimeout(() => {
                shark.remove();
                
                const equipmentDamage = Math.floor(Math.random() * 20) + 10; // 10-30% damage
                const specimenLoss = Math.floor(Math.random() * 4) + 1; // 1-4 specimens
                const repairCosts = Math.floor(Math.random() * 100000) + 50000; // $50k-150k
                
                // Store insurance status before consuming it
                const hadInsurance = gameState.insurance;
                
                // Apply damage
                gameState.shipHealth = Math.max(0, gameState.shipHealth - equipmentDamage);
                
                // Lose specimens (nets damaged, samples contaminated)
                const lostSpecimens = gameState.specimens.splice(0, Math.min(specimenLoss, gameState.specimens.length));
                lostSpecimens.forEach(specimen => {
                    if (gameState.specimenCounts[specimen.type]) {
                        gameState.specimenCounts[specimen.type]--;
                    }
                });
                
                // Insurance coverage (covers 50% of equipment damage)
                let actualRepairCosts = repairCosts;
                if (gameState.insurance) {
                    actualRepairCosts = Math.floor(repairCosts * 0.5); // Insurance covers 50%
                    gameState.insurance = false; // Insurance is used up
                }
                
                gameState.funding = Math.max(0, gameState.funding - actualRepairCosts);
                
                // Add ship damage animation
                document.getElementById('ship').classList.add('ship-damage');
                setTimeout(() => {
                    document.getElementById('ship').classList.remove('ship-damage');
                }, 3000);
                
                const insuranceText = hadInsurance ? 
                    `\n\n🛡️ Insurance covered 50% of repair costs!` : 
                    `\n\n💡 Ship insurance could have reduced these losses!`;
                
                showPopup('Shark Attack!', 
                    `🦈 A massive shark has attacked the Sorcerer II!\n\n` +
                    `The beast damaged collection equipment and contaminated samples!\n\n` +
                    `🚢 Equipment Damage: -${equipmentDamage}%\n` +
                    `🧪 Specimens Lost: ${lostSpecimens.length}\n` +
                    `💰 Repair Costs: ${actualRepairCosts.toLocaleString()}` +
                    insuranceText);
                
                updateDisplay();
            }, 4000);
        }

        function showWarning(message) {
            const warning = document.createElement('div');
            warning.className = 'storm-warning';
            warning.textContent = message;
            document.querySelector('.ocean-view').appendChild(warning);
            
            setTimeout(() => {
                warning.remove();
            }, 3000);
        }

        function createMassiveStorm() {
            const stormContainer = document.getElementById('storm-effects');
            stormContainer.classList.add('active');
            
            // Create intense lightning
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const lightning = document.createElement('div');
                    lightning.className = 'lightning';
                    lightning.style.left = `${Math.random() * 100}%`;
                    stormContainer.appendChild(lightning);
                    
                    setTimeout(() => lightning.remove(), 200);
                }, i * 100);
            }
            
            // Create heavy rain
            for (let i = 0; i < 150; i++) {
                setTimeout(() => {
                    const rain = document.createElement('div');
                    rain.className = 'rain';
                    rain.style.left = `${Math.random() * 100}%`;
                    rain.style.animationDelay = `${Math.random() * 0.5}s`;
                    stormContainer.appendChild(rain);
                    
                    setTimeout(() => rain.remove(), 2000);
                }, i * 10);
            }
            
            setTimeout(() => {
                stormContainer.classList.remove('active');
            }, 5000);
        }

        function purchaseInsurance() {
            if (gameState.funding < 100000) {
                showPopup('Insufficient Funds', 'Ship insurance costs $100,000.');
                return;
            }
            
            gameState.funding -= 100000;
            gameState.insurance = true;
            
            showPopup('Insurance Purchased', 
                '🛡️ Ship insurance is now active!\n\n' +
                'This will significantly reduce losses from storms and pirate attacks.\n\n' +
                'Coverage includes:\n' +
                '• 70% storm damage protection\n' +
                '• 60% pirate theft protection\n' +
                '• Emergency repair coverage');
            
            updateDisplay();
        }

        function repairShip() {
            if (gameState.funding < 50000) {
                showPopup('Insufficient Funds', 'Ship repairs cost $50,000.');
                return;
            }
            
            const repairAmount = Math.min(50, 100 - gameState.shipHealth);
            gameState.funding -= 50000;
            gameState.shipHealth = Math.min(100, gameState.shipHealth + repairAmount);
            
            showPopup('Ship Repaired', 
                `🔧 Emergency repairs completed!\n\n` +
                `Ship health restored by ${repairAmount}%\n` +
                `Current health: ${gameState.shipHealth}%\n\n` +
                `The Sorcerer II is ready for more adventures!`);
            
            updateDisplay();
        }

        // Initialize game
        updateDisplay();
        
        // Generate initial research request
        setTimeout(() => {
            generateResearchRequest();
        }, 3000);
        
        // Add some initial specimens
        setTimeout(() => {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => createSpecimen(), i * 500);
            }
        }, 1000);
    </script>
</body>
</html>